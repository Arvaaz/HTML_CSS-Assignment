<!DOCTYPE html>
<html>
<head>
	<title></title>
	<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
	<meta http-equiv="Pragma" content="no-cache" />
	<meta http-equiv="Expires" content="0" />
	<script src="bundle.js" type="text/javascript"></script>
	<link rel="stylesheet" href="assignment6.css">
</head>

<body>
	<main>
		<form class="form">
			<div class="info">
				<p><strong class="abc">Characters:</strong> <span class="count">00</span></p>
				<p><strong class="abc">Threads:</strong> <span class="threadCount">00</span></p>
			</div>
			<textarea class="textarea" placeholder="The character limit for each tweet is 275" required="" wrap="soft"
				onkeyup="textInfo(this);"></textarea>
			<button type="submit" class="button">
				Thread
			</button>
		</form>

		<div class="thread-box">

			<div class="thread">
				<p>
					<span class="sl"></span> <br />
					Your threads will be here. <br /><br />
					The character limit for each tweet is 275. <br /><br />
				</p>
			</div>
		</div>
	</main>
	<script>
		const form = document.querySelector(".form");
		const strCount = document.querySelector(".count");
		const threadCount = document.querySelector(".threadCount");
		const threadBox = document.querySelector(".thread-box");
		let size = 275; 
		let LimitArr = [];
		function textInfo(obj) {
			let length = obj.value.length;
			strCount.innerHTML = length;
			threadCount.innerHTML = Math.ceil(length / size);
			length > size
				? (obj.style.color = "red") : (obj.style.color = "seagreen");
		}
		function displayUI(listParent, arr = []) {
			listParent.innerHTML = arr
				.map((el, i) => {
					return `
        <article class="thread" data-index="${i}">

        <div class="tools">
        <span class="index">${i < 9 ? '0' + (i + 1) : i + 1}</span>
        <span class="close" data-index="${i}">✖️</span>
        </div>

        <p class="tweet">
        ${el}
        </p>

        </article>
        `;
				})
				.join("");
		}
		function Limit(str) {
			let splitOnWhiteSpace = str.split(' ');
			let result = [];
			let totalLength = 0;
			let word = '';
			for (let i = 0; i < splitOnWhiteSpace.length; i++) {
				let curWord = splitOnWhiteSpace[i];
				let curWordLength = curWord.length;
				word += curWord + ' '; 
				totalLength += curWordLength + 1;
				if (totalLength >= size) {
					word = word.trim();
					let lengthDiff = word.length - size;

					if (lengthDiff > 0) {
						let lastIndexOfWhiteSpace = word.lastIndexOf(' ');
						word = word.slice(0, lastIndexOfWhiteSpace);

						i--;
					}
					result.push(word);
					totalLength = 0;
					word = '';
				}
				if (i === splitOnWhiteSpace.length - 1 && totalLength <= size && word !== '') {
					result.push(word.trim());
				}
			}

			return result;

		}
		function thread(e) {
			e.preventDefault();

			const thread = document.querySelector(".thread");
			LimitArr = Limit(document.querySelector(".textarea").value);
			displayUI(threadBox, LimitArr);
		}

		form.addEventListener("submit", thread);

		function deleteThread(e) {
			const [el,
				index] = [e.target,
				e.target.dataset.index];
			let txt = e.target.dataset.para;
			if (el.classList.contains("close")) {
				LimitArr.splice(index, 1);
				displayUI(threadBox, LimitArr);
			}
			if (el.classList.contains("copy")) {
			}
		}

		threadBox.addEventListener("click", deleteThread);
	</script>
</body>
<script></script>